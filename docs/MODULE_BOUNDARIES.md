# Module Boundaries

Stage 77 formalises the runtime wiring between core consensus modules, the CLI,
the wallet, and the JavaScript function web. The new `internal/runtime/integration.go` aggregates
critical components—`core.Node`, `core.SynnergyConsensus`, the runtime wallet,
and the virtual machine—so every entrypoint observes the same state transitions
and gas schedule. Documentation has been updated to reflect the expanded module
relationships.

## Domain Groupings

- **Core Runtime**
  - Consensus, VM, ledger, sandbox and runtime integration logic (`core/`,
    `internal/runtime/integration.go`, `virtual_machine.go`, `vm_sandbox_management.go`).
- **Nodes**
  - Specialised node implementations (`watchtower_node.go`,
    `regulatory_node.go`, `energy_efficient_node.go`, `geospatial_node.go`) and
    the new runtime orchestrator that binds them to the CLI and web UI.
- **Tokens & Wallets**
  - Token and asset features (`core/tokens`, `wallet.go`, `walletserver`).
- **Cross-Chain**
  - Interoperability (`cross_chain*.go`, `cross_chain_bridge.go`,
    `cross_chain_transactions.go`).
- **Security & Compliance**
  - Identity, RBAC, regulatory controls, wallet approval flows, and the CLI
    access controls (`firewall.go`, `identity_verification.go`,
    `zero_trust_data_channels.go`, `internal/security`).
- **Deployment & Tooling**
  - Infrastructure automation (`deploy/terraform`, `deploy/k8s`, `docker/`) and
    the browser-based function web (`web/`).

## Integration Contracts

- `internal/runtime/integration.go` provides the canonical runtime for CLI, API, and web
  consumers. CLI commands interact with the same node, consensus engine, wallet,
  and regulatory node that serve Terraform, Kubernetes, and Docker deployments.
- Gas schedules are validated via `EnsureGasCosts`, eliminating drift between
  documentation and runtime pricing for opcodes used by the VM, CLI, and guides.
- Docker, Kubernetes, and Terraform artefacts mount the same configuration
  generated by the runtime integration to guarantee deterministic behaviour.

## Directory Strategy

- `internal/` encapsulates code exclusive to Synnergy binaries and services.
- `pkg/` hosts reusable libraries for external applications.
- `web/` exposes the function web, consuming the CLI and wallet APIs produced by
  the shared runtime integration.

Subsequent production stages will continue to migrate packages into these
boundaries and update imports accordingly.
